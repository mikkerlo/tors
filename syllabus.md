## Модель, Время
- Модель распределенной системы, асинхронность узлов и сети
- Кварцевые и атомные часы, дрейф часов, значения ppm для разных типов часов
- Невозможность синхронизации часов без дрейфа в синхронной системе, невозможность обнаружить асимметрию
- GPS и сихронизация часов, навигационные уравнения, релятевистские эффекты
- Google TrueTime

## Replication, Consistency

- Репликация и асинхронная модель, наблюдаемое поведение, распределенная система как конкурентный объект, линеаризуемость
- Линеаризуемость, физическое время и happens-before между клиентскими операциями
- 1 писатель, кворумные операции, нарушение линеаризуемости
- Синхронная кворумная запись в чтении, аналогия с lock-free, доказательство, 
- Сложность в переходе к нескольким писателям
- Выбор таймстемпов с помощью дополнительной фазы кворумного чтения
- Системы кворумов
- Рестарты узлов и персистентное хранилище
- Переконфигурации
- Попытки обобщения на RMW-операции

## State Machine Replication, Atomic Broadcast, Consensus

\"_There are only two hard problems in distributed systems:  2. Exactly-once delivery 1. Guaranteed order of messages 2. Exactly-once delivery_\"

- Atomic (Totally Ordered) Broadcast и его свойства
- AB как транспорт команд, общая схема линеаризуемой репликации произовольного автомата
- Доказательство линеаризуемости
- Нетривиальные моменты
  * Большие автоматы, шардирование, composability линеаризуемости, транзакции
  * Недетерминизм 
  * Таймауты на клиенте и семантика Exactly Once
  * Read-only операции
- Эквивалентность AB и Consensus, Reliable Broadcast + серия консенсусов
- Свойства safety и liveness, примеры, пересечение safety и liveness свойств

## Impossibility of Consensus

- Отказоустойчивость репликации определяется отказоустойчивостью Consensus
- Граница $`n > 2f`$ для произвольного алгоритма, tradeoff agreement / termination, последствия для AB
- FLP теорема для детерминированных процессов в асинхронной системе, последствия для репликации: есть лайвлок, моменты недоступности системы
- Понятие failure detector-ов

## Basic (Single Decree) Paxos

_\"The Paxos algorithm, when presented in plain English, is very simple.\"_ – Leslie Lamport, _Paxos Made Simple_

- История статьи Part Time Parliament, греки, Paxos Made Simple
- Описание алгоритма: протокол, роли, ballot-ы, фазы, раунды
- Моделирование основных сценариев исполнения
- Выбор значения: контрпример для случая, когда большинство аксепторов приняли одно _значение_
- Выбор значения: доказательство корректности для выбора proposal-а
- Paxos и FLP, сценарий dueling proposers
- Как узнать выбранное значение
- Рестарты и персистентное хранилище
- Fast forwarding

## MultiPaxos

- Явное представление порядка из AB в виде лога команд для автомата, общая схема RSM
- Подходы: MultiPaxos, RAFT, ZAB, разница
- Наивный MultiPaxos, независимые инстансы Basic Paxos в каждом слоте 
- Выборы лидера, простой алгоритм с максимальным id, редиректы и кэширование лидера на клиенте
- Пайплайнинг, в пределе - один rtt на коммит команды
- Захват всего суффикса лога одним ballot number-ом, эпохи
- Финализация команд в логе

## Paxos Made Live

- Выбор числа реплик
- Failure Domains, tradeoff между отказоустойчивостью и латентностью
- Переконфигурации: остановка RSM, наивный подход, служебная команда в реплицируемом логе, alpha-метод Лэмпорта в MultiPaxos
- Read-only операции: stale reads (+только с лидера), опрос кворума, leader leases и физическое время
- Батчинг
- Компактификация лога команд и снэпшоттинг: персистентность, CoW и fork, fuzzy snapshots в ZAB
- Физическое представление лога команд в fs: сегменты, преаллокация
- Ограничения дизайна с выделенным лидером

## Distributed Transactions

- Snapshot isolation, аномалия write skew
- Реализация на стороне клиента на примере BigTable / Percolator, двухфазный коммит, lock-free
- Детерминированные транзакции

## Formal Methods

_\"Weeks of debugging can save you hours of TLA+\"_

- Проблемы дизайна распределенных систем: псевдокод, дизайн доки, прототипы
- Формальный дизайн, model checking
- Структура Крипке и граф конфигураций из FLP теоремы
- Свойства safety и liveness
- Линейная темпоральная логика
- TLA, алгоритм как набор траекторий на структуре Крипке
- Спека TLA для Basic Paxos, моделирование распределенных алгоритмов

## Byzantine Faults

- Модель византийских сбоев, причины, почему алгоритмы RAFT/MultiPaxos не учитывают ее
- Необходимость аутентификации, цифровые подписи
- Граница $`n > 3f`$
- Вероятностный алгоритм Ben-Or для задачи византийского консенсуса

## PBFT

- Public Key Infrastructure
- Как получить ответ от византийской системы
- Византийский лидер: умалчивание команд, реордеринг команд
- Репликация команд, кворумные сертификаты
- Выборы лидера / передача лидерства
- Переход в следующую эпоху
- Коммит команд
- Коды аутентификации сообщений (MAC) против цифровых подписей, non-repudiation 
- Чекпоинты
- Zyzzyva

## Bitcoin

- Общая схема электронных денег, граф транзакций и цифровые подписи
- Проблема double spending и лог транзакций, задача репликация лога в византийском окружении
- Децентрализация и публичность, анонимность и псевдонимность, динамический набор реплик и публичные ключи в качестве адресов
- Блокчейн, блоки, транзакции, gossiping
- Децентрализованная лотерея – PoW, форки, стабилизация, атака 51%, finality
- Мотивация майнеров и эмиссия монет
- Блокчейн через линзы классических алгоритмов репликации, сравнение с PBFT

--- 

- Дополнительные темы
  * Selfish mining,
  * Шардирование и транзакции между блокчейнами (atomic swaps)
  * Анонимность и доказательства с нулевым разглашением

## HotStuff

- TODO